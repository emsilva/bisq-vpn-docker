# =============================================================================
# BISQ DOCKER COMPOSE - NO VPN VERSION
# =============================================================================
# This configuration runs Bisq without VPN protection.
# 
# ⚠️  WARNING: This exposes your real IP address to the Bisq network.
# Only use this if:
# - You're already behind a VPN at the system/router level
# - You're comfortable with the privacy implications
# - You're testing in a development environment
#
# Usage: docker compose -f docker-compose.novpn.yml up -d
# =============================================================================

services:
  bisq:
    build:
      context: docker/bisq
      dockerfile: Dockerfile
      args:
        - BISQ_VERSION=${BISQ_VERSION:-1.9.21}
    container_name: bisq
    ports:
      # Bisq noVNC web interface
      - "6080:6080"
      # VNC direct access (optional)
      - "5901:5901"
    volumes:
      # Main Bisq data directory - contains wallet, trade history, tor hidden service, etc.
      - ./volumes/bisq-data:/home/bisq/.local/share/Bisq
      # XFCE and application configs
      - ./volumes/bisq-config:/home/bisq/.config
    environment:
      - DISPLAY=:1
      - VNC_PASSWORD=${VNC_PASSWORD:-bisqvnc}
      - TZ=${TZ:-America/Sao_Paulo}
      # User/Group ID mapping (defaults to 1000:1000)
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
    stdin_open: true
    tty: true
    restart: unless-stopped
    
    # Resource limits for Bisq application container
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 1G
    
    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "200m"
        max-file: "10"
        labels: "service=bisq,component=application"
    
    # Security configuration
    security_opt:
      - no-new-privileges:true
      # - seccomp=./security/bisq-seccomp.json  # Temporarily disabled for init system compatibility
    
    # Additional security hardening
    read_only: false  # Cannot be read-only due to Bisq data writes
    tmpfs:
      - /tmp:noexec,nosuid,size=512m
      - /var/tmp:noexec,nosuid,size=256m

# =============================================================================
# NETWORK INFORMATION
# =============================================================================
# This setup uses Docker's default bridge network, which means:
# - Your host IP will be visible to the Bisq network
# - Tor hidden service will still work for P2P connections
# - Consider using a system-level VPN for privacy
# =============================================================================